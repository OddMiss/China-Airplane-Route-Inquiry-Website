<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Map Generator</title>
    <script src="https://assets.pyecharts.org/assets/v5/echarts.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/pyecharts/1.9.0/pyecharts.min.js"></script>
    <script type="text/javascript" src="https://assets.pyecharts.org/assets/v5/maps/china.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script>
</head>
<body>
    <!-- <form id="mapForm" onsubmit="return false" action="#" method="post">
        <p id="p1">Begin city:
            <input name="Begin_city" type="text" id="Begin_city" tabindex="1" size="20" value="北京" placeholder="Begin city(default: 北京)"/>
        </p>
        <p id="p2">End city:
            <input name="End_city" type="text" id="End_city" tabindex="2" size="20" value="深圳" placeholder="End city(default: 深圳)"/>
        </p>
        <p><input type="submit" value="Search"></p>
    </form> -->

    <h1>Search Airline</h1>
    <label for="begin_city">Begin City:</label>
    <input type="text" id="begin_city" name="begincity"><br>
    <label for="end_city">End City:</label>
    <input type="text" id="end_city" name="endcity"><br>
    <button onclick="queryAirline()">Query</button><br>

    <!-- <h1>Map Generator</h1>
    <button onclick="Map_Generate()">Generate Map</button> -->
    <div id="map-container" style="width:1000px; height:600px;">
        <!-- Map will be displayed here -->
    </div>
    <script>
        // document.getElementById('mapForm').addEventListener('submit', function(event) {
        //     event.preventDefault(); // Prevent form submission
        //     Map_Generate(); // Call map generation function
        //     console.log("This is the funciton(event).")
        // });

        // function Map_Generate() {
        //     var chartDom = document.getElementById('map-container');
        //     var myChart = echarts.init(chartDom);
        //     var option = {{geo_opt | safe}};
        //     myChart.setOption(option);
        // }

        // function Map_Generate() {
        //    fetch('/generate_map')
        //        .then(response => response.json())
        //        .then(data => {
        //            var mapOptions = {{ data | tojson | safe }};
        //            var chartDom = document.getElementById('map-container');
        //            var myChart = echarts.init(chartDom);
        //            myChart.setOption(mapOptions);
        //        });
        //    } 

        function queryAirline() {
            var begin_city = document.getElementById("begin_city").value;
            var end_city = document.getElementById("end_city").value;

            // 发送 Ajax 请求到后端，获取地图数据
            fetch('/generate_map', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ begin_city: begin_city, end_city: end_city }),
            })
            .then(response => response.json())
            .then(data => {
                // 渲染地图
                var myChart = echarts.init(document.getElementById('map-container'));
                myChart.setOption(data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>